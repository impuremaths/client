<!DOCTYPE html><html lang="en"><html>
<head><title>Impuremaths Client</title></head>
<body>
<button>Server time:</button><span id="serverTime">Unknown</span>
   
<script>
var serverURL = 'wss://impuremaths.herokuapp.com';
var ws = new WebSocket(serverURL);
setupWebsocket();

function setupWebsocket(restart) {
	ws.onopen = function() { console.log("Connected to server!"); };
	ws.onclose = function() { 
		ws = new WebSocket(serverURL);
		setupWebsocket(true);
	}

	ws.customEvents = {};
	ws.on = function(cueName, eventAction) { ws.customEvents[cueName] = eventAction; };
	ws.emit = function(cueName, payload) { 
		if (ws.readyState == 1) ws.send(JSON.stringify({cueName:cueName, payload:payload})); 
		return (ws.readyState == 1);
	};
	ws.onmessage = function(event) {
		let data;
		try { data = JSON.parse(event.data); }
		catch { 
			console.log("Unparseable server message.")
			console.error(event.data);
			return false;
		}			
		if (data && data.cueName && ws.customEvents[data.cueName]) ws.customEvents[data.cueName](data.payload);
		else {
			console.log("Unrecognized server message.")
			console.error(event.data);
		}
	};

	// Custom commands	
	ws.on('serverPong', function(data) { 
		document.getElementById("serverTime").textContent = data;
	});
}
        
</script>
</body>
</html>
